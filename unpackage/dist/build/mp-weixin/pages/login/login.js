(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"0e28":function(e,n,t){"use strict";t.r(n);var r=t("b5c4"),o=t("7af7");for(var a in o)"default"!==a&&function(e){t.d(n,e,(function(){return o[e]}))}(a);t("6cac");var i,c=t("f0c5"),u=Object(c["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],i);n["default"]=u.exports},"2d2f":function(e,n,t){"use strict";(function(e,r){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=c(t("a34a")),a=t("2f62"),i=(t("09fa"),t("783c"));function c(e){return e&&e.__esModule?e:{default:e}}function u(e,n,t,r,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void t(s)}c.done?n(u):Promise.resolve(u).then(r,o)}function s(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){u(a,r,o,i,c,"next",e)}function c(e){u(a,r,o,i,c,"throw",e)}i(void 0)}))}}function f(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?f(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var p={deviceId:(0,i.getDeviceUUID)(),scene:"login"},g={data:function(){return{platform:e.getSystemInfoSync().platform,userInfo:{},username:"",password:"",positionTop:0,isDevtools:!1,loading:!1}},computed:(0,a.mapState)(["forcedLogin","hasLogin","univerifyErrorMsg","hideUniverify"]),onLoad:function(){},methods:l(l({},(0,a.mapMutations)(["login"])),{},{initPosition:function(){this.positionTop=e.getSystemInfoSync().windowHeight-100},loginByPwd:function(){var n=this;return s(o.default.mark((function t(){var a;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.loading=!0,!(n.username.length<3)){t.next=4;break}return e.showToast({icon:"none",title:"账号最短为 3 个字符"}),t.abrupt("return");case 4:if(!(n.password.length<6)){t.next=7;break}return e.showToast({icon:"none",title:"密码最短为 6 个字符"}),t.abrupt("return");case 7:a=l({username:n.username,password:n.password,captcha:n.captchaText},p),r.callFunction({name:"user-center",data:{action:"login",params:a},success:function(t){0==t.result.code?(n.needCaptcha=!1,e.setStorageSync("uni-needCaptcha",n.needCaptcha),e.setStorageSync("uni_id_token",t.result.token),e.setStorageSync("username",t.result.username),e.setStorageSync("nickName",t.result.nickName),e.setStorageSync("avatar",t.result.avatar),e.setStorageSync("login_type","online"),e.setStorageSync("uni_id_has_pwd",!0),n.loading=!1,n.toHome()):(e.showModal({content:t.result.message,showCancel:!1}),n.needCaptcha=t.result.needCaptcha,e.setStorageSync("uni-needCaptcha",n.needCaptcha),n.needCaptcha&&n.captcha("createCaptcha"))},fail:function(n){e.showModal({content:JSON.stringify(n),showCancel:!1})},complete:function(){n.loginBtnLoading=!1}});case 9:case"end":return t.stop()}}),t)})))()},oauth:function(){return new Promise((function(n,t){e.login({provider:"weixin",success:function(e){n(e.code)},fail:function(e){t(new Error("微信登录失败"))}})}))},getUserInfo:function(){return s(o.default.mark((function n(){return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,t){e.getUserInfo({provider:"weixin",success:function(e){n(e.userInfo)},fail:function(n){e.showToast({icon:"none",title:"授权失败"}),t(n)}})})));case 1:case"end":return n.stop()}}),n)})))()},toHome:function(){this.login(this.userInfo.nickName,this.userInfo.avatarUrl),e.reLaunch({url:"../tabBar/design-home/design-home"})},updateUser:function(e,n){r.callFunction({name:"user-center",data:{uniIdToken:e,action:"updateUser",params:{userInfo:n}}})},loginByWeixin:function(){var n=this;return s(o.default.mark((function t(){var a,i,c,u;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n.loading=!0,t.next=3,n.oauth();case 3:return a=t.sent,t.next=6,r.callFunction({name:"user-center",data:{action:"loginByWeixin",params:{code:a}}});case 6:if(i=t.sent,c=i.result.token,0!==i.result.code){t.next=25;break}return t.next=11,e.getSetting();case 11:if(u=t.sent,console.log(u),!u[1].authSetting["scope.userInfo"]){t.next=18;break}return t.next=16,n.getUserInfo();case 16:n.userInfo=t.sent,n.updateUser(c,n.userInfo);case 18:e.setStorageSync("uni_id_token",i.result.token),e.setStorageSync("uni_id_token_expired",i.result.tokenExpired),e.setStorageSync("login_type","online"),e.setStorageSync("nickName",n.userInfo.nickName),e.setStorageSync("avatar",n.userInfo.avatarUrl),n.loading=!1,n.toHome();case 25:case"end":return t.stop()}}),t)})))()}}),onReady:function(){this.initPosition(),this.isDevtools="devtools"===e.getSystemInfoSync().platform}};n.default=g}).call(this,t("543d")["default"],t("a9ff")["default"])},"3c40":function(e,n,t){},"6cac":function(e,n,t){"use strict";var r=t("3c40"),o=t.n(r);o.a},"7af7":function(e,n,t){"use strict";t.r(n);var r=t("2d2f"),o=t.n(r);for(var a in r)"default"!==a&&function(e){t.d(n,e,(function(){return r[e]}))}(a);n["default"]=o.a},"9a2f":function(e,n,t){"use strict";(function(e){t("e2fc");r(t("66fd"));var n=r(t("0e28"));function r(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t("543d")["createPage"])},b5c4:function(e,n,t){"use strict";t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return r}));var r={uLoading:function(){return t.e("uview-ui/components/u-loading/u-loading").then(t.bind(null,"86d0"))},mInput:function(){return t.e("components/m-input/m-input").then(t.bind(null,"7b06"))}},o=function(){var e=this,n=e.$createElement;e._self._c},a=[]}},[["9a2f","common/runtime","common/vendor"]]]);